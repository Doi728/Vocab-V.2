<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåßÔ∏è Vocab Repeater ‚òî</title>
  <style>
    :root {
      --main-bg: #e0eaf0;
      --accent: #aac3d8;
      --accent2: #dce9f2;
      --accent3: #f0f6fa;
      --text: #2e3a40;
      --button: #88a8c6;
      --button-text: #ffffff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      color: var(--text);
    }

    header {
      background: var(--button);
      color: var(--button-text);
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      background: var(--accent);
    }

    nav button {
      flex: 1 1 20%;
      padding: 12px;
      background: var(--accent);
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    nav button.active {
      background: var(--accent2);
      font-weight: bold;
    }

    section {
      padding: 20px;
      padding-left: 5%;
      padding-right: 5%;
      box-sizing: border-box;
    }

    textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #b0c4d4;
      border-radius: 8px;
      background: #f9fbfc;
      box-sizing: border-box;
    }

    button {
      padding: 10px 15px;
      font-size: 16px;
      background: var(--button);
      color: var(--button-text);
      border: none;
      border-radius: 6px;
      margin: 5px 5px 5px 0;
      cursor: pointer;
    }

    .card {
      background: var(--accent3);
      padding: 12px;
      margin: 10px 0;
      border-left: 6px solid var(--button);
      border-radius: 6px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }

    .card small {
      display: block;
      color: gray;
      margin-top: 4px;
    }

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    .input-row input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #b0c4d4;
      border-radius: 8px;
      background: #f9fbfc;
      box-sizing: border-box;
    }

    .search, #searchBox {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #b0c4d4;
      border-radius: 8px;
      background: #f9fbfc;
      box-sizing: border-box;
      margin: 10px 0;
    }

    label {
      margin-right: 10px;
    }

    @media screen and (max-width: 600px) {
      header {
        font-size: 20px;
        padding: 10px;
      }

      nav button {
        font-size: 14px;
        padding: 10px;
      }

      section {
        padding: 15px;
      }

      textarea, button, input {
        font-size: 14px;
      }

      .card {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header>üåßÔ∏è Vocab Repeater ‚òî</header>
  <nav>
    <button onclick="showPage('add')" class="active">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå</button>
    <button onclick="showPage('review')">üîÅ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</button>
    <button onclick="showPage('list')">üìò ‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå</button>
    <button onclick="showPage('quiz')">üìù ‡∏Ñ‡∏ß‡∏¥‡∏ã</button>
    <button onclick="showPage('manual')">üçÉ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à</button>
  </nav>

  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå -->
  <section id="add">
    <h2>‚òî ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà</h2>
    <div id="addContainer"></div>
    <button onclick="addInputRow()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>
    <button onclick="addAllVocab()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </section>

  <!-- ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô SRS -->
  <section id="review" style="display:none">
    <h2>üåßÔ∏è ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</h2>
    <div id="reviewList"></div>
  </section>

  <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå -->
  <section id="list" style="display:none">
    <h2>üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <input type="text" id="searchBox" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥" oninput="renderAllList()" />
    <button onclick="shuffleList()">üîÄ ‡∏™‡∏∏‡πà‡∏°</button>
    <div id="allList"></div>
  </section>

  <!-- ‡∏Ñ‡∏ß‡∏¥‡∏ã -->
  <section id="quiz" style="display:none">
    <h2>üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö</h2>
    <div id="quizBox"></div>
  </section>

  <!-- ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à -->
  <section id="manual" style="display:none">
    <h2>üçÉ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à</h2>
    <label><input type="checkbox" id="hideWord" onchange="renderManual()"> ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</label>
    <label><input type="checkbox" id="hideDef" onchange="renderManual()"> ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</label>
    <div id="manualList"></div>
  </section>

  <script>
    const VOCAB_KEY = 'vocab_list_v2'
    const SCORE_KEY = 'vocab_quiz_score'
    const intervals = [1800, 3600, 43200, 86400, 259200, 604800, 1209600, 2592000]

    function getVocab() {
      return JSON.parse(localStorage.getItem(VOCAB_KEY) || '[]')
    }

    function saveVocab(data) {
      localStorage.setItem(VOCAB_KEY, JSON.stringify(data))
    }

    function addInputRow() {
      const row = document.createElement('div')
      row.className = 'input-row'
      row.innerHTML = `
        <input placeholder="‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå" />
        <input placeholder="‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•" />
      `
      document.getElementById('addContainer').appendChild(row)
    }

    function addAllVocab() {
      const rows = document.querySelectorAll('#addContainer .input-row')
      const vocab = getVocab()
      let added = 0
      rows.forEach(row => {
        const inputs = row.querySelectorAll('input')
        const word = inputs[0].value.trim()
        const def = inputs[1].value.trim()
        if (word && def) {
          vocab.push({
            word,
            def,
            created: Date.now(),
            nextReview: Date.now() + intervals[0] * 1000,
            step: 0
          })
          added++
        }
      })
      if (added > 0) {
        saveVocab(vocab)
        document.getElementById('addContainer').innerHTML = ''
        alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡πâ‡∏ß ${added} ‡∏Ñ‡∏≥!`)
      } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥")
      }
    }

    function showPage(page) {
      const pages = ['add', 'review', 'list', 'quiz', 'manual']
      pages.forEach(id => {
        document.getElementById(id).style.display = id === page ? 'block' : 'none'
      })
      document.querySelectorAll('nav button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.includes(
          page === 'add' ? '‡πÄ‡∏û‡∏¥‡πà‡∏°' :
          page === 'review' ? '‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô' :
          page === 'list' ? '‡∏Ñ‡∏•‡∏±‡∏á' :
          page === 'quiz' ? '‡∏Ñ‡∏ß‡∏¥‡∏ã' : '‡∏ï‡∏≤‡∏°‡πÉ‡∏à'
        ))
      })
      if (page === 'review') renderReviewList()
      if (page === 'list') renderAllList()
      if (page === 'quiz') renderQuiz()
      if (page === 'manual') renderManual()
    }

    function renderAllList() {
      const all = getVocab()
      const query = document.getElementById('searchBox').value.toLowerCase()
      const filtered = all.filter(v => v.word.toLowerCase().includes(query))
      const container = document.getElementById('allList')
      container.innerHTML = ''
      if (filtered.length === 0) {
        container.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</p>"
        return
      }
      filtered.forEach(v => {
        const nextMs = v.nextReview - Date.now()
        const nextMin = Math.round(nextMs / 60000)
        const hr = Math.floor(nextMin / 60)
        const min = nextMin % 60
        const days = Math.floor(hr / 24)
        const remHr = hr % 24
        const timeStr = nextMin <= 0 ? '‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ' :
          (days > 0 ? `${days} ‡∏ß‡∏±‡∏ô ${remHr} ‡∏ä‡∏°.` :
          hr > 0 ? `${hr} ‡∏ä‡∏°. ${min} ‡∏ô‡∏≤‡∏ó‡∏µ` :
          `${min} ‡∏ô‡∏≤‡∏ó‡∏µ`)

        const card = document.createElement('div')
        card.className = 'card'
        card.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div style="flex:1;">
              <b>${v.word}</b>
              <div>${v.def}</div>
              <small>‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${timeStr}</small>
            </div>
            <button onclick="deleteVocab('${v.word}')" style="margin-left:10px; white-space:nowrap;">üóëÔ∏è</button>
          </div>
        `
        container.appendChild(card)
      })
    }

    function deleteVocab(word) {
      if (!confirm(`‡∏•‡∏ö "${word}" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`)) return;
      const vocab = getVocab().filter(v => v.word !== word)
      saveVocab(vocab)
      renderAllList()
      renderManual()
    }

    function renderReviewList() {
      const now = Date.now()
      const vocab = getVocab().filter(v => now >= v.nextReview)
      const container = document.getElementById('reviewList')
      container.innerHTML = ''
      if (vocab.length === 0) {
        container.innerHTML = "<p>‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>"
        return
      }
      vocab.forEach((v, i) => {
        const id = `def_${i}`
        const card = document.createElement('div')
        card.className = 'card'
        card.innerHTML = `
          <b>${v.word}</b>
          <div id="${id}" style="display:none; margin-top:8px;">${v.def}</div>
          <button onclick="document.getElementById('${id}').style.display='block'">üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</button>
          <div style="margin-top:8px;">
            <button onclick="markReview('${v.word}', 'easy')">üòÑ ‡∏à‡∏≥‡πÑ‡∏î‡πâ</button>
            <button onclick="markReview('${v.word}', 'medium')">ü§î ‡∏•‡∏≤‡∏á‡πÜ</button>
            <button onclick="markReview('${v.word}', 'hard')">üòµ ‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</button>
          </div>
        `
        container.appendChild(card)
      })
    }

    function markReview(word, level) {
      const vocab = getVocab().map(v => {
        if (v.word === word) {
          v.step = level === 'easy' ? Math.min(v.step + 1, intervals.length - 1)
                : level === 'hard' ? Math.max(v.step - 1, 0)
                : v.step
          v.nextReview = Date.now() + intervals[v.step] * 1000
        }
        return v
      })
      saveVocab(vocab)
      renderReviewList()
    }

    function shuffleList() {
      const vocab = getVocab().sort(() => Math.random() - 0.5)
      saveVocab(vocab)
      renderAllList()
    }

    function renderQuiz() {
      const vocab = getVocab()
      if (vocab.length < 4) {
        document.getElementById('quizBox').innerHTML = "<p>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏¥‡∏ã</p>"
        return
      }
      const choices = [...vocab].sort(() => Math.random() - 0.5).slice(0, 4)
      const answer = choices[Math.floor(Math.random() * 4)]
      const score = parseInt(localStorage.getItem(SCORE_KEY) || '0')
      document.getElementById('quizBox').innerHTML = `
        <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏° üåü : ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
        <p><b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ :</b> ${answer.def}</p>
        ${choices.map(c => `<button onclick="checkAnswer('${c.word}', '${answer.word}')">${c.word}</button>`).join('<br><br>')}
      `
    }

    function checkAnswer(selected, correct) {
      let score = parseInt(localStorage.getItem(SCORE_KEY) || '0')
      if (selected === correct) {
        alert("‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!")
        score += 1
      } else {
        alert(`‚ùå ‡∏ú‡∏¥‡∏î ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠: ${correct}`)
        score -= 1
      }
      localStorage.setItem(SCORE_KEY, score)
      renderQuiz()
    }

    function renderManual() {
      const vocab = getVocab()
      const hideWord = document.getElementById('hideWord').checked
      const hideDef = document.getElementById('hideDef').checked
      const container = document.getElementById('manualList')
      container.innerHTML = ''
      vocab.forEach(v => {
        const card = document.createElement('div')
        card.className = 'card'
        card.innerHTML = `
          <b>${hideWord ? 'üîí' : v.word}</b><br>
          ${hideDef ? 'üîíüîí' : v.def}
        `
        container.appendChild(card)
      })
    }

    showPage('add')
    addInputRow()
  </script>
</body>
</html>