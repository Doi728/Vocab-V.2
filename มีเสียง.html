<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåßÔ∏è Vocab Repeater ‚òî</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
    :root {
      /* Rain-themed colors (muted blue, grey, cool white) */
      --main-bg: #EAF2F6; /* Light cool grey/blue */
      --accent: #CBD9E1; /* Muted light blue */
      --accent2: #DDE7EF; /* Lighter, cooler blue */
      --accent3: #F0F5F8; /* Very light cool grey */
      --text: #3A4750; /* Dark slate grey */
      --button: #6A8EAB; /* Muted steel blue */
      --button-hover: #597D9A; /* Slightly darker steel blue */
      --button-text: #ffffff;
      --border-color: #AABECB; /* Muted blue-grey border */
      --card-shadow: rgba(0,0,0,0.08);
      --input-bg: #ffffff; /* Clean white for inputs */

      /* Specific colors for flashcard for distinction */
      --flashcard-front-bg: #FFFFFF;
      --flashcard-back-bg: #E7F0F5; /* Very light blue for back */

      /* New Header Colors for a more atmospheric feel */
      --header-start-color: #587C9E; /* Deeper blue-grey */
      --header-end-color: #AABECB;   /* Lighter, misty blue */
      --header-text-color: #ffffff;
      --header-shadow-color: rgba(0,0,0,0.3);
    }

    body {
      font-family: 'IBM Plex Sans Thai', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á Header ‡∏û‡∏£‡πâ‡∏≠‡∏° Animation ‡∏ù‡∏ô‡∏ï‡∏Å */
    header {
      background: linear-gradient(to bottom, var(--header-start-color), var(--header-end-color));
      color: var(--header-text-color);
      padding: 25px 20px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¢‡∏î‡∏ù‡∏ô */
      text-align: center;
      font-size: 36px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
      font-weight: 600;
      text-shadow: 2px 2px 4px var(--header-shadow-color); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
      box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡∏Ç‡∏≠‡∏á Header */
      border-bottom: 1px solid rgba(255,255,255,0.3); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
      letter-spacing: 1px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
      
      /* *** ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Animation *** */
      position: relative; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Header ‡πÄ‡∏õ‡πá‡∏ô container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¢‡∏î‡∏ù‡∏ô */
      overflow: hidden;   /* ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏¢‡∏î‡∏ù‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å Header */
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô Header ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏¢‡∏î‡∏ù‡∏ô */
    .header-text-content {
      position: relative; /* ‡∏™‡∏£‡πâ‡∏≤‡∏á stacking context ‡πÉ‡∏´‡∏°‡πà */
      z-index: 2; /* ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¢‡∏î‡∏ô‡πâ‡∏≥‡∏ù‡∏ô */
    .rain-drop {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.5); /* ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
      width: 2px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏¢‡∏î */
      height: 25px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏¢‡∏î */
      border-radius: 1px; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≤‡∏¢‡∏´‡∏¢‡∏î‡∏°‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
      animation: fall linear infinite; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Animation */
      pointer-events: none; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡∏´‡∏¢‡∏î‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°) */
      z-index: 1; /* ‡∏ß‡∏≤‡∏á‡∏´‡∏¢‡∏î‡∏ù‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Header */
    }

    /* Keyframes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Animation ‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏¢‡∏î‡∏ù‡∏ô */
    @keyframes fall {
      0% { transform: translateY(-100%); opacity: 1; } /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á Header ‡πÅ‡∏•‡∏∞‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà */
      100% { transform: translateY(calc(100% + 50px)); opacity: 0; } /* ‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤‡∏û‡πâ‡∏ô Header ‡πÅ‡∏•‡∏∞‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏õ */
    }

    /* ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡∏¢‡∏î‡∏ù‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ */
    /* ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏¢‡∏î‡∏ù‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 20 ‡∏´‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô */
    .rain-drop:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 2.5s; }
    .rain-drop:nth-child(2) { left: 25%; animation-delay: 1.2s; animation-duration: 3s; }
    .rain-drop:nth-child(3) { left: 5%; animation-delay: 0.5s; animation-duration: 2s; }
    .rain-drop:nth-child(4) { left: 40%; animation-delay: 1.8s; animation-duration: 2.8s; }
    .rain-drop:nth-child(5) { left: 15%; animation-delay: 0.9s; animation-duration: 3.2s; }
    .rain-drop:nth-child(6) { left: 55%; animation-delay: 0.3s; animation-duration: 2.3s; }
    .rain-drop:nth-child(7) { left: 80%; animation-delay: 1.5s; animation-duration: 3.5s; }
    .rain-drop:nth-child(8) { left: 35%; animation-delay: 0.7s; animation-duration: 2.7s; }
    .rain-drop:nth-child(9) { left: 70%; animation-delay: 2s; animation-duration: 3s; }
    .rain-drop:nth-child(10) { left: 95%; animation-delay: 0.6s; animation-duration: 2.6s; }
    .rain-drop:nth-child(11) { left: 20%; animation-delay: 1.3s; animation-duration: 2.9s; }
    .rain-drop:nth-child(12) { left: 50%; animation-delay: 0.1s; animation-duration: 2.1s; }
    .rain-drop:nth-child(13) { left: 65%; animation-delay: 1.6s; animation-duration: 3.1s; }
    .rain-drop:nth-child(14) { left: 5%; animation-delay: 0.8s; animation-duration: 2.4s; }
    .rain-drop:nth-child(15) { left: 90%; animation-delay: 0.4s; animation-duration: 3.3s; }
    .rain-drop:nth-child(16) { left: 30%; animation-delay: 1s; animation-duration: 2.6s; }
    .rain-drop:nth-child(17) { left: 75%; animation-delay: 0.2s; animation-duration: 3.4s; }
    .rain-drop:nth-child(18) { left: 85%; animation-delay: 1.7s; animation-duration: 2.7s; }
    .rain-drop:nth-child(19) { left: 45%; animation-delay: 0.5s; animation-duration: 3s; }
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    <div class="rain-drop"></div>
    </header>
  <nav>
    <button onclick="showPage('add')" class="active">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå</button>
    <button onclick="showPage('review')">üîÅ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</button>
    <button onclick="showPage('list')">üìò ‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå</button>
    <button onclick="showPage('quiz')">üìù ‡∏Ñ‡∏ß‡∏¥‡∏ã</button>
    <button onclick="showPage('flashcard')">üóÇÔ∏è ‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
    <button onclick="showPage('flashcardReview')">üìã ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</button>
    <button onclick="showPage('customReview')">üéØ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à</button>
  </nav>

  <section id="add">
    <h2>‚òî ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà</h2>
    <p>‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß :</p>
    <textarea id="bulkInput" rows="10" placeholder="‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°:‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå > ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á > ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•
‡πÄ‡∏ä‡πà‡∏ô:apple  ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏• ‡∏´‡∏£‡∏∑‡∏≠ book. ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
      
‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏±‡∏î‡πÑ‡∏õ"></textarea>
    <button onclick="addVocab()">üíæ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</button>
  </section>

  <section id="review" style="display:none">
    <h2>üåßÔ∏è ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</h2>
    <div id="reviewList"></div>
  </section>

  <section id="list" style="display:none">
    <h2>üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <input type="text" id="searchBox" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå..." oninput="renderAllList()" />
    <div class="button-group">
      <button onclick="shuffleList()">üîÄ ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</button>
      <button onclick="exportVocab()">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
      <label for="importFile" class="button">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)
        <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importVocab(event)" />
      </label>
    </div>
    <div id="allList"></div>
  </section>

  <section id="quiz" style="display:none">
    <h2>üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h2>
    <div class="button-group quiz-submenu-nav" style="margin-bottom: 25px;">
      <button onclick="showQuizSubmenu('multipleChoiceQuiz')" class="active">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö</button>
      <button onclick="showQuizSubmenu('writeAnswerQuiz')">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ö</button>
      <button onclick="showQuizSubmenu('trueFalseQuiz')">‡∏à‡∏£‡∏¥‡∏á/‡πÄ‡∏ó‡πá‡∏à</button>
      <button onclick="showQuizSubmenu('matchWordsGame')">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</button>
    </div>

    <div id="multipleChoiceQuiz" class="quiz-submenu">
      <h3>‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö</h3>
      <div id="quizBox">
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
      </div>
    </div>

    <div id="writeAnswerQuiz" class="quiz-submenu" style="display:none;">
      <h3>‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ö</h3>
      <div id="writeAnswerBox">
        <p style="text-align:center;">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
      </div>
    </div>

    <div id="trueFalseQuiz" class="quiz-submenu" style="display:none;">
      <h3>‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á/‡πÄ‡∏ó‡πá‡∏à</h3>
      <div id="trueFalseBox">
        <p style="text-align:center;">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
      </div>
    </div>

    <div id="matchWordsGame" class="quiz-submenu" style="display:none;">
      <h3>‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥</h3>
      <div id="matchWordsBox">
        <p style="text-align:center;">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</p>
      </div>
    </div>

  </section>

  <section id="flashcard" style="display:none">
    <h2>üóÇÔ∏è ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</h2>
    <div id="flashcardBox">
      <p style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</p>
    </div>
  </section>

  <section id="flashcardReview" style="display:none">
    <h2>üìã ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î</h2>
    <div id="flashcardReviewBox">
      <p style="text-align:center;">‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
    </div>
  </section>

  <section id="customReview" style="display:none">
    <h2>üéØ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à</h2>
    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô :</p>
    <div class="checkbox-group">
      <label><input type="checkbox" id="toggleWord" checked onchange="renderCustomReview()"> ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <label><input type="checkbox" id="toggleDef" checked onchange="renderCustomReview()"> ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</label>
    </div>
    <div id="customReviewList"></div>
  </section>

  <script>
    const VOCAB_KEY = 'vocab_list_v2';
    const SCORE_KEY = 'vocab_quiz_score';
    // Review intervals in seconds: 30m, 1h, 12h, 1d, 3d, 7d, 14d, 30d
    const intervals = [1800, 3600, 43200, 86400, 259200, 604800, 1209600, 2592000];
    let flashcardWrong = []; // Stores words marked "‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" from flashcards

    // New: Speech synthesis function
    function speak(text) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US'; // Set a default language, you can adjust as needed
        window.speechSynthesis.speak(utterance);
      } else {
        alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
      }
    }

    function getVocab() {
      return JSON.parse(localStorage.getItem(VOCAB_KEY) || '[]');
    }

    function saveVocab(data) {
      localStorage.setItem(VOCAB_KEY, JSON.stringify(data));
    }

    function addVocab() {
      const input = document.getElementById('bulkInput').value.trim();
      if (!input) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°");
        return;
      }
      const lines = input.split('\n');
      const vocab = getVocab();
      let addedCount = 0;
      let errorCount = 0;
      let updatedCount = 0; // Added for clarity, though not used in bulk add's overwrite logic

      lines.forEach(line => {
        // Use regex to split by 2 or more spaces OR a period followed by a space
        const parts = line.split(/ {2,}|\. /);
        if (parts.length < 2) {
          errorCount++;
          return;
        }
        const word = parts[0].trim();
        const def = parts.slice(1).join('. ').trim(); // Rejoin if definition had periods

        if (word && def) {
          // Check for duplicates (case-insensitive word)
          const existingIndex = vocab.findIndex(v => v.word.toLowerCase() === word.toLowerCase());
          if (existingIndex === -1) {
            vocab.push({
              word: word,
              def: def,
              created: Date.now(),
              nextReview: Date.now() + intervals[0] * 1000, // Initial review time
              step: 0 // Current step in the Spaced Repetition System
            });
            addedCount++;
          } else {
            // If exists, update its definition. Keep review progress.
            vocab[existingIndex].def = def;
            updatedCount++; // Count as updated
          }
        } else {
          errorCount++;
        }
      });

      if (addedCount > 0 || updatedCount > 0) {
        saveVocab(vocab);
        document.getElementById('bulkInput').value = ''; // Clear input after adding
        let msg = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß ${addedCount} ‡∏Ñ‡∏≥!`;
        if (updatedCount > 0) {
            msg += ` ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏• ${updatedCount} ‡∏Ñ‡∏≥`;
        }
        alert(msg);
        if (errorCount > 0) {
          alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ ${errorCount} ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
        }
      } else if (errorCount > 0) {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
      } else {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß");
      }
    }

    function deleteVocab(wordToDelete) {
      if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö "${wordToDelete}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå?`)) return;
      let vocab = getVocab().filter(v => v.word !== wordToDelete);
      saveVocab(vocab);
      renderAllList(); // Refresh the list after deletion
    }

    function renderReviewList() {
      const now = Date.now();
      const vocab = getVocab();
      const reviewList = vocab.filter(v => now >= v.nextReview);
      const container = document.getElementById('reviewList');
      container.innerHTML = ''; // Clear previous content

      if (reviewList.length === 0) {
        container.innerHTML = "<p style='text-align:center; padding: 20px;'>‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å!</p>";
        return;
      }

      reviewList.forEach((v, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        const definitionId = `def_review_${index}`; // Unique ID for each definition

        card.innerHTML = `
          <div class="card-header">
            <div class="vocab-word" onclick="speak('${v.word.replace(/'/g, "\\'")}')" style="cursor: pointer;">${v.word}</div>
            <button class="show-def-button" onclick="document.getElementById('${definitionId}').style.display='block'">üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</button>
          </div>
          <div id="${definitionId}" class="definition" style="display:none;">${v.def}</div>
          <div class="card-actions">
            <button onclick="markReview('${v.word.replace(/'/g, "\\'")}', 'easy')">üòÑ ‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</button>
            <button onclick="markReview('${v.word.replace(/'/g, "\\'")}', 'medium')">ü§î ‡∏•‡∏≤‡∏á‡πÜ</button>
            <button onclick="markReview('${v.word.replace(/'/g, "\\'")}', 'hard')">üòµ ‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function markReview(wordToMark, level) {
      let vocab = getVocab().map(v => {
        if (v.word === wordToMark) {
          // Adjust step based on review level
          if (level === 'easy') {
            v.step = Math.min(v.step + 1, intervals.length - 1);
          } else if (level === 'hard') {
            v.step = Math.max(v.step - 1, 0); // Go back one step, or stay at 0
          } else { // medium
            // v.step stays the same. Maybe slightly reset nextReview for "medium" to reiterate sooner?
            // For now, let's keep it simple: medium means keep current step, nextReview is based on current step
            v.nextReview = Date.now() + intervals[v.step] * 1000;
            return v; // Return early if nextReview was just set explicitly
          }
          // Calculate next review time for easy/hard
          v.nextReview = Date.now() + intervals[v.step] * 1000;
        }
        return v;
      });
      saveVocab(vocab);
      renderReviewList(); // Re-render the review list
    }

    function renderAllList() {
      const allVocab = getVocab();
      const query = document.getElementById('searchBox').value.toLowerCase();
      const filteredVocab = allVocab.filter(v =>
        v.word.toLowerCase().includes(query) || v.def.toLowerCase().includes(query)
      );
      const container = document.getElementById('allList');
      container.innerHTML = '';

      if (filteredVocab.length === 0) {
        container.innerHTML = "<p style='text-align:center; padding: 20px;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>";
        return;
      }

      filteredVocab.forEach(v => {
        const nextMs = v.nextReview - Date.now();
        const nextMin = Math.round(nextMs / 60000); // Convert milliseconds to minutes

        let timeStr;
        if (nextMin <= 0) {
          timeStr = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ';
        } else if (nextMin < 60) {
          timeStr = `${nextMin} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        } else if (nextMin < 60 * 24) {
          const hr = Math.floor(nextMin / 60);
          const min = nextMin % 60;
          timeStr = `${hr} ‡∏ä‡∏°. ${min} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        } else {
          const days = Math.floor(nextMin / (60 * 24));
          const remHr = Math.floor((nextMin % (60 * 24)) / 60);
          timeStr = `${days} ‡∏ß‡∏±‡∏ô ${remHr} ‡∏ä‡∏°.`;
        }

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
              <div class="main-content" onclick="speak('${v.word.replace(/'/g, "\\'")}')" style="cursor: pointer;">${v.word}</div>
              <div class="definition">${v.def}</div>
              <small>‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å: ${timeStr}</small>
            </div>
            <button onclick="deleteVocab('${v.word.replace(/'/g, "\\'")}')" style="flex-shrink: 0; margin-left:15px;">üóëÔ∏è ‡∏•‡∏ö</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function shuffleList() {
      let vocab = getVocab();
      // Only shuffle and save if there are words to shuffle
      if (vocab.length > 0) {
        vocab.sort(() => Math.random() - 0.5);
        saveVocab(vocab);
        renderAllList();
        alert("‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß!");
      } else {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°");
      }
    }

    // --- Import/Export Functions ---
    function exportVocab() {
        const vocab = getVocab();
        const jsonString = JSON.stringify(vocab, null, 2); // Pretty print JSON

        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        // Generate a filename with current date
        const date = new Date();
        const filename = `vocab_repeater_data_${date.getFullYear()}${(date.getMonth() + 1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}.json`;
        a.download = filename;

        document.body.appendChild(a); // Append to body to make it clickable
        a.click(); // Programmatically click the link to trigger download
        document.body.removeChild(a); // Clean up
        URL.revokeObjectURL(url); // Release the URL object
        alert(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏ü‡∏•‡πå: ${filename}`);
    }

    function importVocab(event) {
        const file = event.target.files[0];
        if (!file) {
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (!Array.isArray(importedData)) {
                    alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Array ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå");
                    return;
                }

                let currentVocab = getVocab();
                let addedCount = 0;
                let updatedCount = 0;
                let invalidCount = 0;

                importedData.forEach(newVocabItem => {
                    // Basic validation for imported item structure
                    if (typeof newVocabItem.word !== 'string' || typeof newVocabItem.def !== 'string' || !newVocabItem.word.trim() || !newVocabItem.def.trim()) {
                        invalidCount++;
                        return;
                    }

                    const existingIndex = currentVocab.findIndex(
                        v => v.word.toLowerCase() === newVocabItem.word.toLowerCase()
                    );

                    if (existingIndex !== -1) {
                        // Word exists: Update definition, keep existing review progress
                        currentVocab[existingIndex].def = newVocabItem.def;
                        updatedCount++;
                    } else {
                        // New word: Add with initial review progress
                        currentVocab.push({
                            word: newVocabItem.word,
                            def: newVocabItem.def,
                            created: Date.now(),
                            nextReview: Date.now() + intervals[0] * 1000,
                            step: 0
                        });
                        addedCount++;
                    }
                });

                saveVocab(currentVocab);
                alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô: ‡πÄ‡∏û‡∏¥‡πà‡∏° ${addedCount} ‡∏Ñ‡∏≥, ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ${updatedCount} ‡∏Ñ‡∏≥.${invalidCount > 0 ? ` (‡∏°‡∏µ ${invalidCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏Ç‡πâ‡∏≤‡∏°)` : ''}`);
                renderAllList(); // Refresh the list
            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: " + error.message);
                console.error("Error importing file:", error);
            } finally {
                // Clear the file input so the same file can be selected again
                event.target.value = '';
            }
        };
        reader.readAsText(file);
    }
    // --- End Import/Export Functions ---


    function getScore() {
      return parseInt(localStorage.getItem(SCORE_KEY) || '0');
    }

    function saveScore(score) {
      localStorage.setItem(SCORE_KEY, score);
    }

    // --- Quiz Type 1: Multiple Choice Quiz (Original) ---
    function renderQuiz() {
      const vocab = getVocab();
      const quizBox = document.getElementById('quizBox');

      if (vocab.length < 4) {
        quizBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏Ñ‡∏ß‡∏¥‡∏ã üìù</p>";
        return;
      }

      // Shuffle and pick 4 unique choices
      const shuffledVocab = [...vocab].sort(() => Math.random() - 0.5);
      const choices = shuffledVocab.slice(0, 4);

      // Randomly select one as the correct answer
      const answer = choices[Math.floor(Math.random() * 4)];
      const currentScore = getScore();

      quizBox.innerHTML = `
        <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°: <b>${currentScore}</b> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
        <p><b>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå:</b> <span style="font-size: 20px; color: var(--button); cursor: pointer;" onclick="speak('${answer.word.replace(/'/g, "\\'")}')">${answer.word}</span></p>
        <div style="margin-top: 25px;">
          ${choices.map(c =>
            `<button onclick="checkAnswerQuiz('${c.def.replace(/'/g, "\\'")}', '${answer.def.replace(/'/g, "\\'")}')">${c.def}</button>`
          ).join('')}
        </div>
      `;
    }

    function checkAnswerQuiz(selectedDef, correctDef) {
      let score = getScore();
      if (selectedDef === correctDef) {
        alert("‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!");
        score += 1;
      } else {
        alert(`‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: "${correctDef}"`);
        score = Math.max(0, score - 1); // Don't go below 0
      }
      saveScore(score);
      renderQuiz(); // Load next quiz question
    }

    // --- Quiz Type 2: Write Answer Quiz ---
    let currentWriteAnswerVocab = null;

    function renderWriteAnswerQuiz() {
      const vocab = getVocab();
      const writeAnswerBox = document.getElementById('writeAnswerBox');

      if (vocab.length === 0) {
        writeAnswerBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ö ‚úçÔ∏è</p>";
        return;
      }

      const randomIndex = Math.floor(Math.random() * vocab.length);
      currentWriteAnswerVocab = vocab[randomIndex];

      writeAnswerBox.innerHTML = `
        <p><b>‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•:</b> <span style="font-size: 20px; color: var(--button); cursor: pointer;" onclick="speak('${currentWriteAnswerVocab.def.replace(/'/g, "\\'")}')">${currentWriteAnswerVocab.def}</span></p>
        <input type="text" id="writeAnswerInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á..." style="text-align:center; margin-top: 20px;" onkeypress="if(event.keyCode==13) checkWriteAnswer()">
        <button onclick="checkWriteAnswer()">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        <button onclick="renderWriteAnswerQuiz()">‚û°Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°</button>
      `;
      document.getElementById('writeAnswerInput').focus();
    }

    function checkWriteAnswer() {
      const userAnswer = document.getElementById('writeAnswerInput').value.trim();
      if (!userAnswer) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
        return;
      }

      if (currentWriteAnswerVocab && userAnswer.toLowerCase() === currentWriteAnswerVocab.word.toLowerCase()) {
        alert("‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!");
      } else {
        alert(`‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: "${currentWriteAnswerVocab.word}"`);
      }
      renderWriteAnswerQuiz();
    }

    // --- Quiz Type 3: True/False Quiz ---
    function renderTrueFalseQuiz() {
      const vocab = getVocab();
      const trueFalseBox = document.getElementById('trueFalseBox');

      if (vocab.length < 2) {
        trueFalseBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á/‡πÄ‡∏ó‡πá‡∏à ‚úîÔ∏è‚ùå</p>";
        return;
      }

      const randomIndex1 = Math.floor(Math.random() * vocab.length);
      let randomIndex2 = Math.floor(Math.random() * vocab.length);

      while (randomIndex1 === randomIndex2 && vocab.length > 1) {
        randomIndex2 = Math.floor(Math.random() * vocab.length);
      }

      const vocab1 = vocab[randomIndex1];
      const vocab2 = vocab[randomIndex2];

      const isTrue = Math.random() < 0.5;

      let displayedWord;
      let displayedDef;
      let correctAnswer;

      if (isTrue) {
        displayedWord = vocab1.word;
        displayedDef = vocab1.def;
        correctAnswer = true;
      } else {
        displayedWord = vocab1.word;
        displayedDef = vocab2.def;
        correctAnswer = false;
      }

      trueFalseBox.innerHTML = `
        <p><b>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå:</b> <span style="font-size: 20px; color: var(--button); cursor: pointer;" onclick="speak('${displayedWord.replace(/'/g, "\\'")}')">${displayedWord}</span></p>
        <p><b>‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•:</b> "${displayedDef}"</p>
        <div style="text-align:center; margin-top: 20px;">
          <button onclick="checkTrueFalseAnswer(${true}, ${correctAnswer})">‚úîÔ∏è ‡∏à‡∏£‡∏¥‡∏á</button>
          <button onclick="checkTrueFalseAnswer(${false}, ${correctAnswer})">‚ùå ‡πÄ‡∏ó‡πá‡∏à</button>
        </div>
      `;
    }

    function checkTrueFalseAnswer(userChoice, correctAnswer) {
      if (userChoice === correctAnswer) {
        alert("‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
      } else {
        alert(`‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: "${correctAnswer ? '‡∏à‡∏£‡∏¥‡∏á' : '‡πÄ‡∏ó‡πá‡∏à'}"`);
      }
      renderTrueFalseQuiz();
    }

    // --- Quiz Type 4: Match Words Game ---
    let currentMatchPairs = [];
    let selectedMatchCard = null;
    let matchedPairsCount = 0;

    function renderMatchWordsGame() {
      const vocab = getVocab();
      const matchWordsBox = document.getElementById('matchWordsBox');

      if (vocab.length < 4) {
        matchWordsBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà üß©</p>";
        return;
      }

      // Reset game state
      currentMatchPairs = [];
      selectedMatchCard = null;
      matchedPairsCount = 0;

      const shuffledVocab = [...vocab].sort(() => Math.random() - 0.5);
      const gameVocab = shuffledVocab.slice(0, 4);

      gameVocab.forEach(v => {
        currentMatchPairs.push({ type: 'word', value: v.word, originalWord: v.word, originalDef: v.def, matched: false });
        currentMatchPairs.push({ type: 'def', value: v.def, originalWord: v.word, originalDef: v.def, matched: false });
      });

      currentMatchPairs.sort(() => Math.random() - 0.5);

      let cardsHtml = '';
      currentMatchPairs.forEach((pair, index) => {
        cardsHtml += `
          <div class="match-card" data-index="${index}" data-original-word="${pair.originalWord}" onclick="selectMatchCard(this)">
            ${pair.value}
          </div>
        `;
      });

      matchWordsBox.innerHTML = `
        <div id="matchCardsContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-top: 20px;">
          ${cardsHtml}
        </div>
        <p style="text-align: center; margin-top: 20px;">
          <button onclick="renderMatchWordsGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </p>
      `;
    }

    function selectMatchCard(cardElement) {
      if (cardElement.classList.contains('matched')) {
        return;
      }

      if (selectedMatchCard === cardElement) {
        cardElement.classList.remove('selected');
        selectedMatchCard = null;
        return;
      }

      cardElement.classList.add('selected');

      if (selectedMatchCard) {
        const card1Word = selectedMatchCard.dataset.originalWord;
        const card2Word = cardElement.dataset.originalWord;

        if (card1Word === card2Word) {
          selectedMatchCard.classList.add('matched');
          cardElement.classList.add('matched');
          selectedMatchCard.classList.remove('selected');
          cardElement.classList.remove('selected');

          matchedPairsCount++;
          if (matchedPairsCount === currentMatchPairs.length / 2) {
            setTimeout(() => {
              alert("üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!");
              renderMatchWordsGame();
            }, 500);
          }
        } else {
          setTimeout(() => {
            alert("‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
            selectedMatchCard.classList.remove('selected');
            cardElement.classList.remove('selected');
          }, 500);
        }
        selectedMatchCard = null;
      } else {
        selectedMatchCard = cardElement;
      }
    }


    let currentFlashcardIndex = 0;
    let flashcardVocab = [];

    function renderFlashcard() {
      flashcardVocab = [...getVocab()];
      const flashcardBox = document.getElementById('flashcardBox');

      if (flashcardVocab.length === 0) {
        flashcardBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î üóÇÔ∏è</p>";
        return;
      }

      if (currentFlashcardIndex === 0) {
          flashcardVocab.sort(() => Math.random() - 0.5);
      }

      const card = flashcardVocab[currentFlashcardIndex];
      if (!card) {
        flashcardBox.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!</p>";
        currentFlashcardIndex = 0;
        flashcardVocab = [];
        return;
      }

      flashcardBox.innerHTML = `
        <div class="flashcard-container">
          <div class="flashcard" onclick="this.classList.toggle('flipped')">
            <div class="flashcard-front">${card.word}</div>
            <div class="flashcard-back">${card.def}</div>
          </div>
        </div>
        <div style="text-align:center; margin-top: 20px;">
          <button onclick="speak('${card.word.replace(/'/g, "\\'")}')">üîâ ‡∏ü‡∏±‡∏á</button>
          <button onclick="nextFlashcard(true)">üòÑ ‡∏à‡∏≥‡πÑ‡∏î‡πâ</button>
          <button onclick="nextFlashcard(false, '${card.word.replace(/'/g, "\\'")}')">üòµ ‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</button>
        </div>
      `;
    }

    function nextFlashcard(gotIt, word) {
      if (!gotIt && word) {
        if (!flashcardWrong.includes(word)) {
          flashcardWrong.push(word);
        }
      }
      currentFlashcardIndex++;
      if (currentFlashcardIndex >= flashcardVocab.length) {
        alert("‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!");
        currentFlashcardIndex = 0;
        renderFlashcard();
      } else {
        renderFlashcard();
      }
    }

    function renderFlashcardReview() {
      const reviewVocab = getVocab().filter(v => flashcardWrong.includes(v.word));
      const box = document.getElementById('flashcardReviewBox');
      box.innerHTML = '';

      if (reviewVocab.length === 0) {
        box.innerHTML = "<p style='text-align:center; padding: 20px;'>‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>";
        return;
      }

      reviewVocab.forEach((v, i) => {
        const id = `fcr_def_${i}`;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">
            <div class="vocab-word" onclick="speak('${v.word.replace(/'/g, "\\'")}')" style="cursor: pointer;">${v.word}</div>
            <button class="show-def-button" onclick="document.getElementById('${id}').style.display='block'">üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</button>
          </div>
          <div id="${id}" class="definition" style="display:none;">${v.def}</div>
          <div class="card-actions">
            <button onclick="removeFromFlashcardReview('${v.word.replace(/'/g, "\\'")}')">‚úÖ ‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</button>
          </div>
        `;
        box.appendChild(card);
      });
    }

    function removeFromFlashcardReview(wordToRemove) {
      flashcardWrong = flashcardWrong.filter(w => w !== wordToRemove);
      renderFlashcardReview();
    }

    function renderCustomReview() {
      const showWord = document.getElementById('toggleWord').checked;
      const showDef = document.getElementById('toggleDef').checked;
      const vocab = getVocab();
      const box = document.getElementById('customReviewList');
      box.innerHTML = '';

      if (vocab.length === 0) {
        box.innerHTML = "<p style='text-align:center; padding: 20px;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡πà‡∏≠‡∏ô</p>";
        return;
      }

      vocab.forEach(v => {
        const card = document.createElement('div');
        card.className = 'card';

        const wordPart = showWord ? `<div class="main-content" onclick="speak('${v.word.replace(/'/g, "\\'")}')" style="cursor: pointer;"><b>${v.word}</b></div>` : `<div class="main-content"><b>üîí ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</b></div>`;
        const defPart = showDef ? `<div class="definition">${v.def}</div>` : `<div class="definition">‚ùì‚ùì ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</div>`;

        card.innerHTML = `${wordPart}${defPart}`;
        box.appendChild(card);
      });
    }

    // Function to show specific quiz sub-menus
    function showQuizSubmenu(submenuId) {
      const submenus = ['multipleChoiceQuiz', 'writeAnswerQuiz', 'trueFalseQuiz', 'matchWordsGame'];
      submenus.forEach(id => {
        document.getElementById(id).style.display = 'none'; // Hide all quiz sub-menus
      });
      document.getElementById(submenuId).style.display = 'block'; // Show selected sub-menu

      // Update active state for quiz sub-menu buttons
      document.querySelectorAll('.quiz-submenu-nav button').forEach(btn => {
        btn.classList.remove('active');
      });
      // Find the button that corresponds to the selected submenuId and set it as active
      document.querySelector(`.quiz-submenu-nav button[onclick*="${submenuId}"]`).classList.add('active');


      // Call the specific render function for the chosen quiz
      if (submenuId === 'multipleChoiceQuiz') renderQuiz();
      else if (submenuId === 'writeAnswerQuiz') renderWriteAnswerQuiz();
      else if (submenuId === 'trueFalseQuiz') renderTrueFalseQuiz();
      else if (submenuId === 'matchWordsGame') renderMatchWordsGame();
    }

    function showPage(pageId) {
      const pages = [
        'add', 'review', 'list', 'quiz',
        'flashcard', 'flashcardReview', 'customReview'
      ];
      pages.forEach(id => {
        document.getElementById(id).style.display = 'none'; // Hide all pages
      });
      document.getElementById(pageId).style.display = 'block'; // Show selected page

      // Update active state for navigation buttons
      document.querySelectorAll('nav button').forEach(btn => {
        btn.classList.remove('active');
        if (pageId === 'add' && btn.textContent.includes('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå')) btn.classList.add('active');
        else if (pageId === 'review' && btn.textContent.includes('‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô')) btn.classList.add('active');
        else if (pageId === 'list' && btn.textContent.includes('‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå')) btn.classList.add('active');
        else if (pageId === 'quiz' && btn.textContent.includes('‡∏Ñ‡∏ß‡∏¥‡∏ã')) btn.classList.add('active');
        else if (pageId === 'flashcard' && btn.textContent.includes('‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î')) btn.classList.add('active');
        else if (pageId === 'flashcardReview' && btn.textContent.includes('‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏ü‡∏•‡∏ä‡∏Å‡∏≤‡∏£‡πå‡∏î')) btn.classList.add('active');
        else if (pageId === 'customReview' && btn.textContent.includes('‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏à')) btn.classList.add('active');
      });

      // Call relevant render functions when page is shown
      if (pageId === 'review') renderReviewList();
      if (pageId === 'list') renderAllList();
      if (pageId === 'quiz') {
        // When the main 'quiz' page is shown, default to 'multipleChoiceQuiz'
        showQuizSubmenu('multipleChoiceQuiz');
      }
      if (pageId === 'flashcard') {
          currentFlashcardIndex = 0;
          flashcardWrong = [];
          renderFlashcard();
      }
      if (pageId === 'flashcardReview') renderFlashcardReview();
      if (pageId === 'customReview') renderCustomReview();
    }

    // Initial page load
    showPage('add');
  </script>
</body>
</html>